<!DOCTYPE html>
<html lang="ja" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>mri.com-user:seto:run_test</title>
<meta name="generator" content="DokuWiki"/>
<meta name="theme-color" content="#008800"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="mri.com-user,seto,run_test"/>
<!--[if gte IE 9]><!-->
<script >/*<![CDATA[*/var NS='mri.com-user:seto';var JSINFO = {"id":"mri.com-user:seto:run_test","namespace":"mri.com-user:seto","ACT":"export_xhtml","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<link rel="stylesheet" type="text/css" href="standard.css">
<script charset="utf-8" src="/~ocpublic/wiki/lib/exe/jquery.php?tseed=34a552433bc33cc9c3bc32527289a0b2" defer="defer"></script>
<script charset="utf-8" src="/~ocpublic/wiki/lib/exe/js.php?t=dokuwiki&amp;tseed=1ba1ca9e5699c4cd37eb1cb4bdf6d000" defer="defer"></script>
<!--<![endif]-->
</head>
<body>
<div class="dokuwiki export">
<div class="level1"><a href="index.html">MRI.COM</a></div>
<!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">目次</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#標準実験のチュートリアル">標準実験のチュートリアル</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#実験環境の用意">実験環境の用意</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#パッケージの展開">パッケージの展開</a></div></li>
<li class="level3"><div class="li"><a href="#入力データの展開">入力データの展開</a></div></li>
<li class="level3"><div class="li"><a href="#シンボリック・リンクの作成_一度だけ">シンボリック・リンクの作成(一度だけ)</a></div></li>
<li class="level3"><div class="li"><a href="#シンボリック・リンクの作成_実験ごと">シンボリック・リンクの作成(実験ごと)</a></div></li>
<li class="level3"><div class="li"><a href="#初期値データの用意">初期値データの用意</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#mricomのコンパイル">MRI.COMのコンパイル</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#気象研海洋_スパコンの場合">気象研海洋、スパコンの場合</a></div></li>
<li class="level3"><div class="li"><a href="#その他の場合">その他の場合</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#プログラムの実行">プログラムの実行</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#実行の準備">実行の準備</a></div></li>
<li class="level3"><div class="li"><a href="#プログラムの実行1">プログラムの実行</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#実験結果の確認と後処理">実験結果の確認と後処理</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#リスタートファイルとヒストリーファイル">リスタートファイルとヒストリーファイル</a></div></li>
<li class="level3"><div class="li"><a href="#解の簡単な確認">解の簡単な確認</a></div></li>
<li class="level3"><div class="li"><a href="#ファイルの掃除">ファイルの掃除</a></div></li>
<li class="level3"><div class="li"><a href="#後処理">後処理</a></div></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="標準実験のチュートリアル">標準実験のチュートリアル</h1>
<div class="level1">

<p>
デフォルト設定で実験を行う手順です。
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u6a19\u6e96\u5b9f\u9a13\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb&quot;,&quot;hid&quot;:&quot;\u6a19\u6e96\u5b9f\u9a13\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-106&quot;} -->
<h2 class="sectionedit2" id="実験環境の用意">実験環境の用意</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u5b9f\u9a13\u74b0\u5883\u306e\u7528\u610f&quot;,&quot;hid&quot;:&quot;\u5b9f\u9a13\u74b0\u5883\u306e\u7528\u610f&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;107-141&quot;} -->
<h3 class="sectionedit3" id="パッケージの展開">パッケージの展開</h3>
<div class="level3">

<p>
パッケージのtar ballを展開するか、gitでパッケージを取得する。
</p>
<pre class="code">&gt; git clone [共有リポジトリURL]</pre>

<p>
以下、展開したディレクトリを$HOMEと表記する。
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u5c55\u958b&quot;,&quot;hid&quot;:&quot;\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u5c55\u958b&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;142-372&quot;} -->
<h3 class="sectionedit4" id="入力データの展開">入力データの展開</h3>
<div class="level3">

<p>
実験入力データ一式(MRICOM-seto-data.tar.gz)を気象研開発者から取得し、適当な場所($HOME/の下でなくて良い)で展開する。
</p>
<pre class="code">&gt; tar -zxvf MRICOM-seto-data.tar.gz</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u5165\u529b\u30c7\u30fc\u30bf\u306e\u5c55\u958b&quot;,&quot;hid&quot;:&quot;\u5165\u529b\u30c7\u30fc\u30bf\u306e\u5c55\u958b&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;373-603&quot;} -->
<h3 class="sectionedit5" id="シンボリック・リンクの作成_一度だけ">シンボリック・リンクの作成(一度だけ)</h3>
<div class="level3">

<p>
以下のシンボリック・リンクを作る。
</p>
<div class="table sectionedit6"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0">リンク</th><th class="col1">リンク先</th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0">$HOME/linkdir/data</td><td class="col1">MRICOM-seto-data.tarを展開して現れるdataディレクトリ</td>
	</tr>
	<tr class="row2">
		<td class="col0">$HOME/linkdir/restart</td><td class="col1">同じくrestartディレクトリ</td>
	</tr>
	<tr class="row3">
		<td class="col0">$HOME/linkdir/result</td><td class="col1">出力ファイル用のディレクトリ(どこでも良い)。以降、絶対パスを$RESULTと表記</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;722-1022&quot;} -->
<p>
気象研内であれば、トップのシェル・スクリプト Setup.sh でリンクが作られます。
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30fb\u30ea\u30f3\u30af\u306e\u4f5c\u6210(\u4e00\u5ea6\u3060\u3051)&quot;,&quot;hid&quot;:&quot;\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30fb\u30ea\u30f3\u30af\u306e\u4f5c\u6210_\u4e00\u5ea6\u3060\u3051&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;604-1134&quot;} -->
<h3 class="sectionedit7" id="シンボリック・リンクの作成_実験ごと">シンボリック・リンクの作成(実験ごと)</h3>
<div class="level3">

<p>
次に実験の出力用のディレクトリを作る。
</p>
<pre class="code">&gt; cd $HOME/exp
&gt; sh make_newexp.sh [適当な実験名]</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30fb\u30ea\u30f3\u30af\u306e\u4f5c\u6210(\u5b9f\u9a13\u3054\u3068)&quot;,&quot;hid&quot;:&quot;\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30fb\u30ea\u30f3\u30af\u306e\u4f5c\u6210_\u5b9f\u9a13\u3054\u3068&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;1135-1319&quot;} -->
<h3 class="sectionedit8" id="初期値データの用意">初期値データの用意</h3>
<div class="level3">
<pre class="code">&gt; cd $HOME/exp/run
&gt; sh link_restart.sh</pre>

<p>
初期値ファイルへのシンボリック・リンクが $HOME/exp/restart/ の中に作られる。
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u521d\u671f\u5024\u30c7\u30fc\u30bf\u306e\u7528\u610f&quot;,&quot;hid&quot;:&quot;\u521d\u671f\u5024\u30c7\u30fc\u30bf\u306e\u7528\u610f&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;1320-1511&quot;} -->
<h2 class="sectionedit9" id="mricomのコンパイル">MRI.COMのコンパイル</h2>
<div class="level2">

<p>
ビルド環境を設定してから、MRI.COMをコンパイルします。
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;MRI.COM\u306e\u30b3\u30f3\u30d1\u30a4\u30eb&quot;,&quot;hid&quot;:&quot;mricom\u306e\u30b3\u30f3\u30d1\u30a4\u30eb&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;1512-1626&quot;} -->
<h3 class="sectionedit10" id="気象研海洋_スパコンの場合">気象研海洋、スパコンの場合</h3>
<div class="level3">

<p>
気象研内では、シェル・スクリプトによってビルド環境の設定、並列数の調整、実行スクリプトの修正を一括して行います。
</p>
<pre class="code">&gt; cd $HOME/exp/run
&gt; sh setup.sh main
&gt; cd $HOME/exp/src
&gt; sh compile.sh</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u6c17\u8c61\u7814\u6d77\u6d0b\u3001\u30b9\u30d1\u30b3\u30f3\u306e\u5834\u5408&quot;,&quot;hid&quot;:&quot;\u6c17\u8c61\u7814\u6d77\u6d0b_\u30b9\u30d1\u30b3\u30f3\u306e\u5834\u5408&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;1627-1928&quot;} -->
<h3 class="sectionedit11" id="その他の場合">その他の場合</h3>
<div class="level3">

<p>
コンパイラ等のビルド環境を $HOME/exp/config_files/configure.in に記述する。
詳細は<a href="./mri.com-user_rectangle_run_test.html#ビルド環境の設定" class="wikilink2" title="mri.com-user_rectangle_run_test" rel="nofollow" data-wiki-id="mri.com-user_rectangle_run_test">ビルド環境の設定</a>(矩形海モデル)を参照。
</p>

<p>
その後、exp/srcディレクトリで configure と make を行う。
</p>
<pre class="code">&gt; cd $HOME/exp/src
&gt; ./configure
&gt; make</pre>

<p>
configure (シェル・スクリプト)を実行すると、コンパイルに必要な項目が $HOME/exp/config_files/configure.in ファイルをもとに設定され、Makefileが作成される。
次にmakeによってコンパイルが成功すると実行モジュール ogcm　が作られる。
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u305d\u306e\u4ed6\u306e\u5834\u5408&quot;,&quot;hid&quot;:&quot;\u305d\u306e\u4ed6\u306e\u5834\u5408&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;1929-2583&quot;} -->
<h2 class="sectionedit12" id="プログラムの実行">プログラムの実行</h2>
<div class="level2">

<p>
プログラムの実行は exp/run/ で行う。
用意されているファイルについてはREADME.mdを参照。
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5b9f\u884c&quot;,&quot;hid&quot;:&quot;\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5b9f\u884c&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:12,&quot;range&quot;:&quot;2584-2742&quot;} -->
<h3 class="sectionedit13" id="実行の準備">実行の準備</h3>
<div class="level3">

<p>
実行準備のシェル・スクリプト run_pre.sh を実行する。
</p>
<pre class="code">&gt; cd $HOME/exp/run
&gt; sh run_pre.sh</pre>

<p>
実行モジュール ogcm が実行ディレクトリ $HOME/exp/run にコピーされ、実行時に読み込むNAMELISTファイル(NAMELIST.SETO, NAMELIST.SETO.MONITOR)が作られることを確認して下さい。
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u5b9f\u884c\u306e\u6e96\u5099&quot;,&quot;hid&quot;:&quot;\u5b9f\u884c\u306e\u6e96\u5099&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:13,&quot;range&quot;:&quot;2743-3105&quot;} -->
<h3 class="sectionedit14" id="プログラムの実行1">プログラムの実行</h3>
<div class="level3">

<p>
実行モジュール ogcm を直接に実行するか、編集した run.sh を使う。
</p>
<ul>
<li class="level1"><div class="li"> はじめに実行するときは、デバッグモードにしておくと(NAMELIST.SETOのl_debug=.true.)、どこまで動いたかが分かりやすい。</div>
</li>
<li class="level1"><div class="li"> デフォルトでは20ステップのテスト実験をします。run.conf を編集して、実験の時間ステップや出力を変更できます。</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5b9f\u884c&quot;,&quot;hid&quot;:&quot;\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5b9f\u884c1&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:14,&quot;range&quot;:&quot;3106-3556&quot;} -->
<h2 class="sectionedit15" id="実験結果の確認と後処理">実験結果の確認と後処理</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u5b9f\u9a13\u7d50\u679c\u306e\u78ba\u8a8d\u3068\u5f8c\u51e6\u7406&quot;,&quot;hid&quot;:&quot;\u5b9f\u9a13\u7d50\u679c\u306e\u78ba\u8a8d\u3068\u5f8c\u51e6\u7406&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:15,&quot;range&quot;:&quot;3557-3601&quot;} -->
<h3 class="sectionedit16" id="リスタートファイルとヒストリーファイル">リスタートファイルとヒストリーファイル</h3>
<div class="level3">

<p>
$HOME/exp/restart/ にプレフィックス「rs_」のリスタートファイル、exp/hst_1day/に「hs_」のヒストリーファイルが出力されたことを確認する。
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30ea\u30b9\u30bf\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u3068\u30d2\u30b9\u30c8\u30ea\u30fc\u30d5\u30a1\u30a4\u30eb&quot;,&quot;hid&quot;:&quot;\u30ea\u30b9\u30bf\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u3068\u30d2\u30b9\u30c8\u30ea\u30fc\u30d5\u30a1\u30a4\u30eb&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:16,&quot;range&quot;:&quot;3602-3854&quot;} -->
<h3 class="sectionedit17" id="解の簡単な確認">解の簡単な確認</h3>
<div class="level3">

<p>
標準出力ログは exp/run/log/ に作成される。
</p>

<p>
標準出力ログファイル「SETO-201110101-stdout.0000」中の「SSH Snap Ave」項目(領域平均した海面高度)の値を確認する。
</p>
<pre class="code">% grep &quot;SSH Snap&quot; SETO-201110101-stdout.0000</pre>

<p>
値が 25.18688145148407 に近ければ良い。
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u89e3\u306e\u7c21\u5358\u306a\u78ba\u8a8d&quot;,&quot;hid&quot;:&quot;\u89e3\u306e\u7c21\u5358\u306a\u78ba\u8a8d&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:17,&quot;range&quot;:&quot;3855-4194&quot;} -->
<h3 class="sectionedit18" id="ファイルの掃除">ファイルの掃除</h3>
<div class="level3">
<pre class="code">&gt; cd $HOME/exp
&gt; sh clean_exp_confs.sh</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30d5\u30a1\u30a4\u30eb\u306e\u6383\u9664&quot;,&quot;hid&quot;:&quot;\u30d5\u30a1\u30a4\u30eb\u306e\u6383\u9664&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:18,&quot;range&quot;:&quot;4195-4271&quot;} -->
<h3 class="sectionedit19" id="後処理">後処理</h3>
<div class="level3">

<p>
後処理は以下。
</p>
<pre class="code">% cd lib/
% make  !!! MXEライブラリのコンパイル
% cd setting/
% sh make_namelist.sh  !!! namelist.configure.in の作成。時間(出力ファイルのサフィックス)を変更するには iolst-hst.add を編集
% cd postp/
% sh post.sh [実験名]  !!! 出力ファイルを適当なサブディレクトリに振り分け、gradsコントロールファイルを作る</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u5f8c\u51e6\u7406&quot;,&quot;hid&quot;:&quot;\u5f8c\u51e6\u7406&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:19,&quot;range&quot;:&quot;4272-&quot;} --></div>
</body>
</html>
